<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
    <meta name="application-name" content="OpenAgents"/>
    <meta name="description" content="Create and manage your AI agents"/>
    <meta name="author" content="OpenAgents, Inc.">
    <meta name="format-detection" content="telephone=no">
    <link rel="canonical" href="https://openagents.com/agents"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/new.css"/>
    <link rel="stylesheet" href="css/chat.css"/>
    <script src="js/htmx.min.js"></script>
    <script src="js/client-side-templates.js"></script>
    <script src="js/mustache.js"></script>
    <script src="dist/ndk.js"></script>
    <script src="dist/nostr/nostr-agent.js"></script>

    <style>
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 500;
        }
        .status-badge.running { background: #4CAF50; color: white; }
        .status-badge.starting { background: #2196F3; color: white; }
        .status-badge.stopping { background: #FF9800; color: white; }
        .status-badge.stopped { background: #9E9E9E; color: white; }
        .status-badge.error { background: #F44336; color: white; }
        .status-badge.paused { background: #607D8B; color: white; }

        .agent-metrics {
            margin: 10px 0;
            font-size: 0.9em;
            color: #666;
        }

        .agent-actions {
            margin-top: 15px;
        }

        .agent-actions button {
            margin-right: 10px;
        }

        .agent-actions button.danger {
            background: #F44336;
            color: white;
        }

        .agent-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .agent-item h3 {
            margin: 0 0 10px 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            min-height: 100px;
            font-family: monospace;
        }

        .container {
            display: flex;
            gap: 30px;
            padding: 20px;
        }

        .column {
            flex: 1;
        }

        .header {
            padding: 20px;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>

<body class="bg-black text-white font-mono min-h-screen">
    <div class="header py-5 border-b border-zinc-800 mb-5">
        <div class="text-2xl">Agent Management</div>
        <p class="mt-2">Create and manage your AI agents</p>
    </div>

    <div class="container mx-auto max-w-[60rem] px-4">
        <div class="column">
            <!-- Agent Creation Form -->
            <div class="agent-form">
                <h2 class="text-xl font-bold mb-4">Create New Agent</h2>
                <form id="create-agent-form"
                      hx-ext="nostr-agent"
                      nostr-action="create"
                      hx-on="submit: event.preventDefault()">
                    <div class="form-group mb-4">
                        <label for="agent-name" class="block text-sm font-medium text-gray-700">Agent Name</label>
                        <div hx-get="/templates/textinput.mustache"
                             hx-trigger="load"
                             hx-target="#agent-name-container">
                        </div>
                        <div id="agent-name-container"></div>
                    </div>
                    <div class="form-group mb-4">
                        <label for="agent-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="agent-description" name="description" required
                                  class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                                  placeholder="Describe what this agent does..."></textarea>
                    </div>
                    <div class="form-group mb-4">
                        <label for="agent-config" class="block text-sm font-medium text-gray-700">Configuration (JSON)</label>
                        <textarea id="agent-config" name="config" required
                                  class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                                  placeholder='{"version": "1.0.0", "capabilities": []}'></textarea>
                    </div>
                    <div class="form-group mb-4">
                        <label for="memory-limit" class="block text-sm font-medium text-gray-700">Memory Limit (MB)</label>
                        <input type="number" id="memory-limit" name="memory_limit" 
                               class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                               value="128" min="32" max="1024">
                    </div>
                    <div class="form-group mb-4">
                        <label for="cpu-limit" class="block text-sm font-medium text-gray-700">CPU Limit (ms)</label>
                        <input type="number" id="cpu-limit" name="cpu_limit" 
                               class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                               value="1000" min="100" max="10000">
                    </div>
                    <button type="submit" class="btn-nav bg-black hover:bg-zinc-900 text-white text-xs inline-flex items-center justify-center whitespace-nowrap select-none text-center align-middle no-underline outline-none w-full px-6">Create Agent</button>
                </form>
            </div>
        </div>

        <div class="column">
            <!-- Agent List -->
            <div class="agent-list">
                <h2 class="text-xl font-bold mb-4">Your Agents</h2>
                <div id="agent-items"
                     hx-ext="nostr-agent"
                     nostr-subscribe="true"
                     nostr-kinds="[30001, 30004]">
                    <!-- Agent items will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Item Template -->
    <template id="agent-item-template">
        <div class="agent-item border border-gray-300 rounded-lg p-4 mb-4" data-agent-id="{{id}}">
            <h3 class="text-lg font-bold mb-2">{{name}}</h3>
            <p class="text-sm text-gray-700 mb-2">{{description}}</p>
            <div class="agent-status mb-2">
                Status: <span class="status-badge {{status}}">{{status}}</span>
            </div>
            <div class="agent-metrics text-sm text-gray-600 mb-2">
                <div>Memory: {{memory_usage}}MB / {{memory_limit}}MB</div>
                <div>CPU: {{cpu_usage}}ms / {{cpu_limit}}ms</div>
            </div>
            <div class="agent-actions">
                <button nostr-action="start" data-agent-id="{{id}}" class="btn-nav bg-black hover:bg-zinc-900 text-white text-xs inline-flex items-center justify-center whitespace-nowrap select-none text-center align-middle no-underline outline-none w-full px-6">Start</button>
                <button nostr-action="stop" data-agent-id="{{id}}" class="btn-nav bg-black hover:bg-zinc-900 text-white text-xs inline-flex items-center justify-center whitespace-nowrap select-none text-center align-middle no-underline outline-none w-full px-6">Stop</button>
                <button nostr-action="delete" data-agent-id="{{id}}" class="btn-nav bg-red-600 hover:bg-red-700 text-white text-xs inline-flex items-center justify-center whitespace-nowrap select-none text-center align-middle no-underline outline-none w-full px-6">Delete</button>
            </div>
        </div>
    </template>

    <script>
        // Initialize NostrAgent when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.nostrAgent = new NostrAgent()

            // Listen for agent events
            document.addEventListener('agent:created', (e) => {
                console.log('Agent created:', e.detail)
            })

            document.addEventListener('instance:updated', (e) => {
                console.log('Instance updated:', e.detail)
            })

            document.addEventListener('nostr-agent:error', (e) => {
                console.error('Nostr agent error:', e.detail)
                alert(e.detail.message)
            })
        })
    </script>
</body>
</html>
