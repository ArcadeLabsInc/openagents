<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nostr Chat Example</title>
    <script src="../js/htmx.min.js"></script>
    <script src="../js/client-side-templates.js"></script>
    <script src="../js/mustache.js"></script>
    <style>
      .chat-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .messages {
        height: 400px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 20px;
      }
      .message {
        margin-bottom: 10px;
        padding: 8px;
        background: #f5f5f5;
        border-radius: 4px;
      }
      .message .author {
        font-weight: bold;
        color: #2a6;
      }
      .message .time {
        color: #666;
        font-size: 0.8em;
      }
      .message .content {
        margin-top: 5px;
      }
      .message .actions {
        margin-top: 5px;
        font-size: 0.8em;
      }
      .message-form {
        display: flex;
        gap: 10px;
      }
      .message-form input {
        flex: 1;
        padding: 8px;
      }
      .message-form button {
        padding: 8px 16px;
      }
      .moderation-panel {
        margin-top: 20px;
        padding: 10px;
        background: #f9f9f9;
      }
      .error-message {
        color: #721c24;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 8px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success-message {
        color: #155724;
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 8px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .channel-form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .channel-form .form-group {
        margin-bottom: 15px;
      }
      .channel-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .channel-form input,
      .channel-form textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .channel-form textarea {
        height: 100px;
        resize: vertical;
      }
      .channel-form button {
        background: #2a6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
      }
      .channel-form button:hover {
        background: #195;
      }
      .channel-list {
        margin-bottom: 20px;
      }
      .channel-item {
        padding: 10px;
        border: 1px solid #ddd;
        margin-bottom: 10px;
        border-radius: 4px;
        cursor: pointer;
      }
      .channel-item:hover {
        background: #f5f5f5;
      }
      .channel-item.active {
        border-color: #2a6;
        background: #e6f3ed;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <!-- Create Channel Form -->
      <div class="channel-form">
        <h2>Create New Channel</h2>
        <form
          id="create-channel-form"
          nostr-chat-create="true"
          hx-on="submit: event.preventDefault()"
        >
          <div class="form-group">
            <label for="channel-name">Channel Name</label>
            <input
              type="text"
              id="channel-name"
              name="name"
              required
              placeholder="My Awesome Channel"
            />
          </div>
          <div class="form-group">
            <label for="channel-about">Description</label>
            <textarea
              id="channel-about"
              name="about"
              required
              placeholder="What's this channel about?"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="channel-picture">Picture URL (optional)</label>
            <input
              type="url"
              id="channel-picture"
              name="picture"
              placeholder="https://example.com/image.jpg"
            />
          </div>
          <button type="submit">Create Channel</button>
        </form>
      </div>

      <!-- Channel List -->
      <div class="channel-list">
        <h3>Your Channels</h3>
        <div id="channel-items">
          <!-- Channel items will be inserted here -->
        </div>
      </div>

      <!-- Chat Interface -->
      <div id="chat-interface" style="display: none">
        <!-- Channel metadata -->
        <div data-channel-metadata></div>

        <!-- Chat messages -->
        <div hx-ext="nostr-chat" class="chat-container">
          <div class="messages" data-messages></div>

          <!-- Message input -->
          <form
            class="message-form"
            nostr-chat-post="true"
            hx-on="submit: event.preventDefault()"
          >
            <input name="content" placeholder="Type a message..." required />
            <button type="submit">Send</button>
          </form>
        </div>

        <!-- Moderation panel -->
        <div class="moderation-panel">
          <h3>Hidden Messages</h3>
          <div id="hidden-messages"></div>

          <h3>Muted Users</h3>
          <div id="muted-users"></div>
        </div>
      </div>
    </div>

    <!-- Message template -->
    <template id="message-template">
      <div
        class="message"
        id="msg-{{id}}"
        data-pubkey="{{pubkey}}"
        data-timestamp="{{created_at}}"
      >
        <span class="author">{{pubkey_short}}</span>
        <span class="time">{{formatted_time}}</span>
        <div class="content">{{content}}</div>
        <div class="actions">
          <button nostr-chat-reply="{{id}}">Reply</button>
          <button nostr-chat-hide="{{id}}">Hide</button>
          <button nostr-chat-mute="{{pubkey}}">Mute User</button>
        </div>
      </div>
    </template>

    <!-- Channel metadata template -->
    <template id="channel-metadata-template">
      <div class="channel-header">
        <h2>{{name}}</h2>
        <p>{{about}}</p>
        <img
          src="{{picture}}"
          alt="Channel picture"
          style="max-width: 100px; border-radius: 50%"
          onerror="this.style.display='none'"
        />
      </div>
    </template>

    <!-- Channel item template -->
    <template id="channel-item-template">
      <div class="channel-item" data-channel-id="{{id}}">
        <h4>{{name}}</h4>
        <p>{{about}}</p>
      </div>
    </template>

    <!-- Load bundled scripts -->
    <script src="../dist/ndk.js"></script>
    <script src="../dist/nostr/nostr-chat.js"></script>
  </body>
</html>
